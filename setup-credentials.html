<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Zoom Video SDK Credentials</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #718096;
            margin-bottom: 30px;
        }

        .info-box {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }

        .info-box h2 {
            color: #2d3748;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .info-box ol {
            margin-left: 20px;
            color: #4a5568;
            line-height: 1.8;
        }

        .info-box li {
            margin-bottom: 8px;
        }

        .info-box a {
            color: #667eea;
            text-decoration: none;
        }

        .info-box a:hover {
            text-decoration: underline;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .label-hint {
            font-weight: 400;
            color: #718096;
            font-size: 0.85rem;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
            font-family: 'Courier New', monospace;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        input.valid {
            border-color: #48bb78;
        }

        input.invalid {
            border-color: #f56565;
        }

        .help-text {
            font-size: 0.85rem;
            color: #718096;
            margin-top: 5px;
        }

        .error-text {
            font-size: 0.85rem;
            color: #f56565;
            margin-top: 5px;
        }

        .success-text {
            font-size: 0.85rem;
            color: #48bb78;
            margin-top: 5px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #cbd5e0;
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }

        .status.info {
            background: #bee3f8;
            color: #2c5282;
            border: 1px solid #90cdf4;
        }

        .back-link {
            display: inline-block;
            color: #667eea;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .validation-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .validation-indicator.valid {
            background: #48bb78;
        }

        .validation-indicator.invalid {
            background: #f56565;
        }

        .validation-indicator.pending {
            background: #cbd5e0;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 15px 0;
            overflow-x: auto;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-group .btn {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Home</a>

        <div class="card">
            <h1>üîë Setup Zoom Video SDK Credentials</h1>
            <p class="subtitle">Validate and test your SDK Key and Secret</p>

            <div class="info-box">
                <h2>üìã How to Get Your Credentials</h2>
                <ol>
                    <li>Go to <a href="https://marketplace.zoom.us/" target="_blank">Zoom Marketplace</a></li>
                    <li>Sign in and click <strong>"Develop"</strong> ‚Üí <strong>"Build App"</strong></li>
                    <li>Choose <strong>"Video SDK"</strong> as the app type</li>
                    <li>Fill in the required information and create your app</li>
                    <li>Go to <strong>"App Credentials"</strong> tab</li>
                    <li>Copy your <strong>SDK Key</strong> and <strong>SDK Secret</strong></li>
                </ol>
                <p style="margin-top: 15px;">
                    <strong>üìö Full Guide:</strong> 
                    <a href="https://developers.zoom.us/docs/video-sdk/get-credentials/" target="_blank">
                        Get Zoom Video SDK Credentials
                    </a>
                </p>
            </div>

            <form id="credentialsForm">
                <div class="form-group">
                    <label for="sdkKey">
                        SDK Key
                        <span class="label-hint">(Usually 20+ alphanumeric characters)</span>
                        <span class="validation-indicator pending" id="keyIndicator"></span>
                    </label>
                    <input 
                        type="text" 
                        id="sdkKey" 
                        name="sdkKey" 
                        placeholder="Enter your SDK Key"
                        autocomplete="off"
                    >
                    <div class="help-text" id="keyHelp">Enter your Zoom Video SDK Key</div>
                </div>

                <div class="form-group">
                    <label for="sdkSecret">
                        SDK Secret
                        <span class="label-hint">(Usually 20+ alphanumeric characters)</span>
                        <span class="validation-indicator pending" id="secretIndicator"></span>
                    </label>
                    <input 
                        type="password" 
                        id="sdkSecret" 
                        name="sdkSecret" 
                        placeholder="Enter your SDK Secret"
                        autocomplete="off"
                    >
                    <div class="help-text" id="secretHelp">Enter your Zoom Video SDK Secret</div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" id="testBtn">Test Credentials</button>
                    <button type="submit" class="btn" id="saveBtn">Save to .env File</button>
                </div>

                <div id="status" class="status" style="display: none;"></div>
            </form>

            <div class="info-box" style="margin-top: 30px;">
                <h2>üí° Note</h2>
                <p style="color: #4a5568; line-height: 1.6;">
                    After validating your credentials, you'll need to add them to your <code>.env</code> file 
                    in the project root directory. The "Save to .env File" button will provide instructions 
                    on how to do this manually (for security reasons, we don't write directly to your file system).
                </p>
            </div>
        </div>
    </div>

    <script>
        const sdkKeyInput = document.getElementById('sdkKey');
        const sdkSecretInput = document.getElementById('sdkSecret');
        const keyIndicator = document.getElementById('keyIndicator');
        const secretIndicator = document.getElementById('secretIndicator');
        const keyHelp = document.getElementById('keyHelp');
        const secretHelp = document.getElementById('secretHelp');
        const testBtn = document.getElementById('testBtn');
        const saveBtn = document.getElementById('saveBtn');
        const statusDiv = document.getElementById('status');

        // Format validation
        function validateFormat(value, minLength = 20) {
            if (!value || value.trim().length === 0) {
                return { valid: false, message: 'This field is required' };
            }
            if (value.length < minLength) {
                return { valid: false, message: `Must be at least ${minLength} characters` };
            }
            if (!/^[a-zA-Z0-9_-]+$/.test(value.trim())) {
                return { valid: false, message: 'Can only contain letters, numbers, hyphens, and underscores' };
            }
            return { valid: true, message: 'Format looks good' };
        }

        // Update indicator
        function updateIndicator(indicator, helpElement, validation) {
            indicator.className = 'validation-indicator ' + (validation.valid ? 'valid' : 'invalid');
            helpElement.className = validation.valid ? 'success-text' : 'error-text';
            helpElement.textContent = validation.message;
        }

        // Real-time validation
        sdkKeyInput.addEventListener('input', () => {
            const validation = validateFormat(sdkKeyInput.value);
            updateIndicator(keyIndicator, keyHelp, validation);
            sdkKeyInput.className = validation.valid ? 'valid' : 'invalid';
        });

        sdkSecretInput.addEventListener('input', () => {
            const validation = validateFormat(sdkSecretInput.value);
            updateIndicator(secretIndicator, secretHelp, validation);
            sdkSecretInput.className = validation.valid ? 'valid' : 'invalid';
        });

        // Test credentials
        testBtn.addEventListener('click', async () => {
            const sdkKey = sdkKeyInput.value.trim();
            const sdkSecret = sdkSecretInput.value.trim();

            // Basic validation
            const keyValidation = validateFormat(sdkKey);
            const secretValidation = validateFormat(sdkSecret);

            if (!keyValidation.valid || !secretValidation.valid) {
                showStatus('error', 'Please fix the format errors above before testing');
                return;
            }

            testBtn.disabled = true;
            testBtn.textContent = 'Testing...';
            hideStatus();

            try {
                const response = await fetch('/api/validate-credentials', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sdkKey: sdkKey,
                        sdkSecret: sdkSecret
                    })
                });

                const data = await response.json();

                if (data.valid) {
                    showStatus('success', `‚úÖ ${data.message}`);
                    keyIndicator.className = 'validation-indicator valid';
                    secretIndicator.className = 'validation-indicator valid';
                } else {
                    showStatus('error', `‚ùå ${data.error || data.message || 'Validation failed'}`);
                    keyIndicator.className = 'validation-indicator invalid';
                    secretIndicator.className = 'validation-indicator invalid';
                }
            } catch (error) {
                console.error('Error:', error);
                showStatus('error', `Failed to test credentials: ${error.message}`);
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'Test Credentials';
            }
        });

        // Save to .env instructions
        saveBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const sdkKey = sdkKeyInput.value.trim();
            const sdkSecret = sdkSecretInput.value.trim();

            const keyValidation = validateFormat(sdkKey);
            const secretValidation = validateFormat(sdkSecret);

            if (!keyValidation.valid || !secretValidation.valid) {
                showStatus('error', 'Please fix the format errors above before saving');
                return;
            }

            // Show instructions
            const envContent = `ZOOM_VIDEO_SDK_KEY=${sdkKey}\nZOOM_VIDEO_SDK_SECRET=${sdkSecret}\nPORT=3000`;
            
            showStatus('info', `
                <strong>üìù Add these lines to your .env file:</strong>
                <div class="code-block">${envContent}</div>
                <p style="margin-top: 10px;">
                    <strong>Steps:</strong><br>
                    1. Create a file named <code>.env</code> in your project root<br>
                    2. Copy the content above into the file<br>
                    3. Save the file<br>
                    4. Restart your server
                </p>
            `);
        });

        function showStatus(type, message) {
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
            statusDiv.style.display = 'block';
        }

        function hideStatus() {
            statusDiv.style.display = 'none';
        }
    </script>
</body>
</html>

